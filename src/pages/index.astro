---
import BaseLayout from '../layouts/BaseLayout.astro';
import PostCard from '../components/PostCard.astro';
import { getCollection } from 'astro:content';

const przemyslenia = (await getCollection('przemyslenia')).map(p => ({ ...p, topic: 'przemyślenia' }));
const kod = (await getCollection('kod')).map(p => ({ ...p, topic: 'kod' }));
const recenzje = (await getCollection('recenzje')).map(p => ({ ...p, topic: 'recenzje' }));

let tworczosc: any[] = [];
try {
  tworczosc = (await getCollection('tworczosc')).map(p => ({ ...p, topic: 'twórczość' }));
} catch (e) {}

const allPosts = [...przemyslenia, ...kod, ...recenzje, ...tworczosc];

const recentPosts = [...allPosts]
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 4);

const paths = [
  { name: 'przemyślenia', slug: 'przemyslenia', count: przemyslenia.length },
  { name: 'kod', slug: 'kod', count: kod.length },
  { name: 'recenzje', slug: 'recenzje', count: recenzje.length },
  ...(tworczosc.length > 0 ? [{ name: 'twórczość', slug: 'tworczosc', count: tworczosc.length }] : []),
];
---

<BaseLayout title="jasisz">
  <div class="home">
    <header class="intro">
      <p class="intro-text">
        Zbiór zapisków o programowaniu, literaturze i rzeczach, które mnie interesują.
        Możesz tu swobodnie błądzić między tematami.
      </p>
    </header>

    <section class="section">
      <h2 class="section-title">Ostatnie</h2>
      <div class="posts-grid">
        {recentPosts.map((post) => (
          <PostCard
            href={`/${post.slug}`}
            title={post.data.title}
            date={post.data.date}
            description={post.data.description}
            topic={post.topic}
            lang={post.data.lang}
            work={post.data.work}
          />
        ))}
      </div>
    </section>

    <section class="section">
      <h2 class="section-title">Ścieżki</h2>
      <nav class="paths">
        {paths.map((path) => (
          <a class="path" href={`/${path.slug}`}>
            {path.name} <span class="path-count">({path.count})</span>
          </a>
        ))}
        <a class="path" href="/wszystko">
          wszystko <span class="path-count">({allPosts.length})</span>
        </a>
        <span class="path-sep">·</span>
        <a class="path path--random" href="/losowa">
          losowa →
        </a>
      </nav>
    </section>
  </div>
</BaseLayout>

<style>
  .home {
    padding: 2rem 0;
  }

  .intro {
    margin-bottom: 3.5rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--grey-color-light);
    position: relative;
  }

  .intro::after {
    content: "~";
    position: absolute;
    bottom: -0.7rem;
    left: 50%;
    transform: translateX(-50%);
    background: var(--background-color);
    padding: 0 1rem;
    color: var(--brand-color);
    font-size: 1.2rem;
  }

  .intro-text {
    font-size: 1.25rem;
    line-height: 1.7;
    color: var(--text-color);
    max-width: 540px;
    font-style: italic;
  }


  /* Paths */
  .paths {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.75rem 1.5rem;
  }

  .path {
    font-size: 1rem;
    font-family: var(--heading-font-family);
    color: var(--text-color);
    text-decoration: none;
    transition: all 0.15s ease;
    padding: 0.25rem 0;
    border-bottom: 1px solid transparent;
  }

  .path:hover {
    color: var(--brand-color);
    text-decoration: none;
    border-bottom-color: var(--brand-color);
  }

  .path-count {
    color: var(--grey-color);
    font-size: 0.85rem;
  }

  .path-sep {
    color: var(--grey-color-light);
  }

  .path--random {
    color: var(--grey-color);
    font-style: italic;
  }

  .path--random:hover {
    color: var(--brand-color);
    border-bottom-color: var(--brand-color);
  }
</style>
